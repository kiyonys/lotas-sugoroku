<!doctype html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>最強経営スゴロク｜参加者</title>
<link rel="stylesheet" href="assets/css/app.css"/>
</head>
<body data-page="attendee">
<div class="wrap">
  <div class="panel">
    <h2>入場フォーム</h2>
    <form id="entryForm">
      <label>会社名（会場には表示しません）</label>
      <input id="company" placeholder="例：ABCモビリティ" required/>
      <label>お名前（会場には表示しません）</label>
      <input id="name" placeholder="例：山田" required/>
      <label>従業員数</label>
      <select id="size" required>
        <option value="">選択</option>
        <option>1-4</option><option>5-9</option><option>10-19</option>
        <option>20-49</option><option>50-99</option><option>100+</option>
      </select>
      <div class="grid-2" style="margin-top:12px">
        <button class="btn accent" type="submit">参加する</button>
        <button class="btn" type="button" id="saveCfgLite">Firebase設定</button>
      </div>
    </form>
<!-- 送信後の完了表示 -->
<div id="done" style="display:none; text-align:center; padding:24px 16px;">
  <h2 style="font-size:22px; margin:0 0 8px; letter-spacing:.02em;">
    スゴロクゲームへのエントリー完了！
  </h2>
  <p style="margin:0; opacity:.9;">
    端末から手を放し、スタートするまでお待ちください。
  </p>
</div>

    <p class="small" style="margin-top:10px">※ 参加情報は会場画面に会社名・氏名は表示されません（個社特定なし）。</p>
  </div>
</div>
<script src="assets/js/app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // 🔹 config.json から設定を取得
  fetch('https://kiyonys.github.io/lotas-sugoroku/config.json')
    .then(response => response.json())
    .then(async config => {
      const app = initializeApp(config);
      const db = getFirestore(app);

      // 🔹 フォーム送信イベント
      const form = document.getElementById('entryForm');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const company = form.company.value;
        const name = form.name.value;
        const size = form.size.value;
        const event = `event-${new Date().toISOString().slice(0,10)}`;
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const company = form.company.value;
  const name    = form.name.value;
  const size    = form.size.value;
  const event   = `event-${new Date().toISOString().slice(0,10)}`;

  // 送信ボタンの無効化（連打防止）
  const submitBtn = form.querySelector('button[type="submit"]');
  submitBtn.disabled = true;
  submitBtn.textContent = '送信中…';

  try {
    await addDoc(collection(db, 'attendees'), {
      company, name, size, event,
      timestamp: serverTimestamp()
    });

    // ✅ 成功：フォームを隠して完了メッセージだけ表示
    form.style.display = 'none';
    const smallNote = document.querySelector('.small');
    if (smallNote) smallNote.style.display = 'none';

    const done = document.getElementById('done');
    done.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' }); // 上に寄せて見せやすく
  } catch (err) {
    alert('⚠️ 登録エラー: ' + err.message);
    console.error(err);
    // 失敗時は元に戻す
    submitBtn.disabled = false;
    submitBtn.textContent = '参加する';
  }
});

          })
    .catch(err => {
      console.error("config.json 読み込みエラー:", err);
    });
</script>


</body></html>
