<!doctype html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>最強経営スゴロク｜参加者</title>
<link rel="stylesheet" href="assets/css/app.css"/>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>
</head>
<body data-page="attendee">
<div class="wrap">
  <div class="panel">
    <h2>入場フォーム</h2>
    <form id="entryForm">
      <label>会社名（会場には表示しません）</label>
      <input id="company" placeholder="例：ABCモビリティ" required/>
      <label>お名前（会場には表示しません）</label>
      <input id="name" placeholder="例：山田" required/>
      <label>従業員数</label>
      <select id="size" required>
        <option value="">選択</option>
        <option>1-4</option><option>5-9</option><option>10-19</option>
        <option>20-49</option><option>50-99</option><option>100+</option>
      </select>
      <div class="grid-2" style="margin-top:12px">
        <button class="btn accent" type="submit">参加する</button>
        <button class="btn" type="button" id="saveCfgLite">Firebase設定</button>
      </div>
    </form>
    <p class="thanks" style="display:none;margin-top:10px">送信しました、ありがとうございます！</p>
    <p class="small" style="margin-top:10px">※ 参加情報は会場画面に会社名・氏名は表示されません（個社特定なし）。</p>
  </div>
</div>
<script src="assets/js/app.js"></script>
</body></html>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Firebase設定をlocalStorageから取得
  const cfg = JSON.parse(localStorage.getItem("lotus_firebase_cfg"));
  if (!cfg) {
    alert("Firebase設定が見つかりません。講師ページで設定してください。");
  } else {
    const app = initializeApp(cfg);
    const db = getFirestore(app);

    // フォーム送信処理
    document.querySelector("button.btn.accent").addEventListener("click", async (e) => {
      e.preventDefault();

      const company = document.querySelector("input[placeholder='例：ABCモビリティ']").value.trim();
      const name = document.querySelector("input[placeholder='例：山田']").value.trim();
      const size = document.querySelector("select").value;

      if (!company || !name || !size) {
        alert("全ての項目を入力してください。");
        return;
      }

      const params = new URLSearchParams(window.location.search);
      const eventId = params.get("event") || "event-unknown";

      try {
        await addDoc(collection(db, "events", eventId, "attendees"), {
          company, name, size, timestamp: serverTimestamp(),
        });
        alert("✅ 登録が完了しました。");
      } catch (err) {
        console.error(err);
        alert("⚠️ 登録エラー: " + err.message);
      }
    });
  }
</script>
