<!doctype html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>最強経営スゴロク｜講師用（ワンファイル）</title>
<link rel="stylesheet" href="assets/css/app.css"/>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>
<script>
// 1回だけ: GitHub Pages上の config.json を読んで保存 → 画面を更新
(async () => {
  try {
    // すでに設定済みなら何もしない（無限リロード防止）
    if (localStorage.getItem('lotus_firebase_cfg')) return;

    const CONFIG_URL = 'https://kiyonys.github.io/lotas-sugoroku/config.json';
    const res = await fetch(CONFIG_URL, { cache: 'no-store' });
    if (!res.ok) throw new Error('fetch failed: ' + res.status);
    const cfg = await res.json();

    // 簡易バリデーション
    if (!cfg.apiKey || !cfg.projectId) throw new Error('invalid config.json');

    // 保存（講師・参加者で共通のキー名）
    localStorage.setItem('lotus_firebase_cfg', JSON.stringify(cfg));

    // 画面を更新（右上の表示が「設定済」になる）
    location.reload();
  } catch (e) {
    console.error('config setup error:', e);
    alert('設定ファイルの読込みに失敗しました: ' + e.message);
  }
})();
</script>
</head>
<body data-page="lecturer">
<div class="wrap">
  <div class="row">
    <div class="panel">
      <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
        <h2>参加者QR</h2><span class="badge" id="badge">未設定</span>
      </div>
      <div id="qr" class="qr-box">QR</div>
      <div class="grid-2" style="margin-top:12px">
        <button class="btn accent" id="btnOpenAttendee">参加者ページを開く</button>
        <button class="btn" id="btnEnding">エンディングへ</button>
      </div>
      <div class="small" style="margin-top:8px">event: <span id="eventKey"></span></div>
    </div>
    <div class="panel">
      <h2>進行ログ</h2>
      <div id="log" class="log"></div>
      <div class="grid-2" style="margin-top:12px">
        <button class="btn" id="btnSetting">設定</button>
        <button class="btn warn" id="btnReset">セッション初期化</button>
      </div>
    </div>
  </div>
  <div class="footer">© Lotus Workshop</div>
</div>
  <!-- Firebase 共通ローダー（config.json を取りにいき、初期化する） -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
<script>
(async () => {
  try {
    // 1) config.json を Pages から取得（キャッシュ無効）
    const CONFIG_URL = 'https://kiyonys.github.io/lotas-sugoroku/config.json';
    const res = await fetch(CONFIG_URL, { cache: 'no-store' });
    if (!res.ok) throw new Error('fetch failed: ' + res.status);
    const cfg = await res.json();

    // 2) LocalStorage に保存（参加者ページでも使う）
    localStorage.setItem('lotus_firebase_cfg', JSON.stringify(cfg));

    // 3) Firebase 初期化（Realtime Database）
    if (!firebase.apps.length) firebase.initializeApp(cfg);
    window.rtdb = firebase.database();

    // 4) eventキー（?event=... があれば保存）
    const p = new URL(location.href).searchParams.get('event');
    if (p) localStorage.setItem('eventKey', p);
    window.EVENT_KEY = localStorage.getItem('eventKey') || p || '';

    // 5) 画面のバッジ/イベント表示を更新（要素がある時だけ）
    const badge = document.getElementById('badge');
    if (badge) badge.textContent = '設定済';
    const ev = document.getElementById('eventKey');
    if (ev && window.EVENT_KEY) ev.textContent = window.EVENT_KEY;
  } catch (e) {
    console.error(e);
    alert('設定ファイルの読み込みに失敗しました：' + e.message);
  }
})();
</script>

</body></html>
<script>
  // --- QR生成：公開URLベースで参加者リンクを出力 ---
  const eventKey = "event-2025-10-21"; // ←日付は必要に応じて変更
  const qrDiv = document.getElementById("qr");
  const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=https://kiyonys.github.io/lotas-sugoroku/attendee.html?event=${eventKey}`;
  qrDiv.innerHTML = `<img src="${qrUrl}" alt="QR" style="border-radius:8px;">`;

  // イベントキー表示
  document.getElementById("eventKey").textContent = eventKey;
</script>
