<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>æœ€å¼·çµŒå–¶ã‚¹ã‚´ãƒ­ã‚¯ï½œè¬›å¸«ç”¨</title>
<style>body{font-family:system-ui,"BIZ UDGothic","Yu Gothic UI";margin:0;background:#f6f7fb}header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#fff;border-bottom:1px solid #e2e4ea}main{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;padding:12px}@media(max-width:1080px){main{grid-template-columns:1fr}}.card{background:#fff;border:1px solid #e2e4ea;border-radius:12px;padding:12px}.log{width:100%;min-height:140px;border:1px solid #e2e4ea;border-radius:8px;padding:8px;font-family:ui-monospace,Menlo,monospace}.qr{display:grid;place-items:center}.btn{padding:.6rem .8rem;border:1px solid #d0d3db;border-radius:.6rem;background:#fff;cursor:pointer}.btnP{background:#5b8def;color:#fff;border-color:#5b8def}.hidden{display:none}.badge{padding:2px 8px;border:1px solid #e2e4ea;border-radius:999px;background:#fff}.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:grid;place-items:center}.box{background:#fff;border:1px solid #e2e4ea;border-radius:12px;padding:14px;max-width:720px;width:min(96vw,720px)}textarea{width:100%;min-height:160px;border:1px solid #e2e4ea;border-radius:8px;padding:8px}</style>
</head>
<body>
<header>
  <div><strong>æœ€å¼·çµŒå–¶ã‚¹ã‚´ãƒ­ã‚¯ï½œè¬›å¸«ç”¨ï¼ˆãƒ¯ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰</strong> <span id="cfgState" class="badge">æœªè¨­å®š</span></div>
  <div><span class="badge">event: <span id="eventId"></span></span>
    <button id="btnCfg" class="btn">è¨­å®š</button>
    <button id="btnReset" class="btn">ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–</button>
  </div>
</header>

<main>
  <section class="card">
    <h3>å‚åŠ è€…QR</h3>
    <div class="qr"><canvas id="qr" width="220" height="220" style="border:1px dashed #ccd"></canvas></div>
    <p><a id="attendeeLink" target="_blank" rel="noopener">å‚åŠ è€…ãƒšãƒ¼ã‚¸ã‚’é–‹ã</a></p>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
      <button id="btnSurvey" class="btn">ğŸ“ ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆQR</button>
      <button id="btnEnding" class="btn">ğŸ¬ ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¸</button>
    </div>
  </section>

  <aside class="card">
    <h3>é€²è¡Œãƒ­ã‚°</h3>
    <textarea id="log" class="log" readonly></textarea>
  </aside>
</main>

<section id="survey" class="card hidden" style="margin:12px">
  <h2>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®ã”å”åŠ›ã‚’ãŠé¡˜ã„ã—ã¾ã™</h2>
  <div class="qr"><canvas id="qrSurvey" width="220" height="220" style="border:1px dashed #ccd"></canvas></div>
  <p><a id="surveyLink" target="_blank" rel="noopener">ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã</a></p>
  <p style="font-size:12px;color:#666">â€» å…¥åŠ›ç›®å®‰90ç§’ã€‚100ç§’å¾Œã«ã‚¢ãƒ ãƒ­ãŒå£°æ›ã‘ã—ã¾ã™ã€‚</p>
</section>

<section id="ending" class="card hidden" style="margin:12px">
  <h2>ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</h2>
  <div id="player"></div>
</section>

<div id="cfgModal" class="modal hidden">
  <div class="box">
    <h3>Firebaseè¨­å®šã‚’è²¼ã‚Šä»˜ã‘ â†’ ä¿å­˜ï¼ˆæ¬¡å›ã‹ã‚‰è‡ªå‹•ï¼‰</h3>
    <textarea id="cfgText" placeholder='{"apiKey":"...","authDomain":"...","databaseURL":"https://...","projectId":"...","appId":"..."}'></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button id="cfgSave" class="btn btnP">ä¿å­˜</button>
      <button id="cfgCancel" class="btn">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
const $=q=>document.querySelector(q);const logEl=$("#log");function log(t){logEl.value+=(logEl.value?"\\n":"")+t;logEl.scrollTop=logEl.scrollHeight;}
const EVENT_ID=(new URL(location.href)).searchParams.get("event")||"event-"+new Date().toISOString().slice(0,10);$("#eventId").textContent=EVENT_ID;
function getCfg(){const s=localStorage.getItem("lotus_firebase_cfg");if(!s)return null;try{return JSON.parse(s);}catch(e){return null;}}
function openCfg(){$("#cfgModal").classList.remove("hidden");const c=getCfg();$("#cfgText").value=c?JSON.stringify(c,null,2):"";}
function saveCfg(){try{const obj=JSON.parse($("#cfgText").value);localStorage.setItem("lotus_firebase_cfg",JSON.stringify(obj));$("#cfgModal").classList.add("hidden");location.reload();}catch(e){alert("JSONã®å½¢å¼ãŒä¸æ­£ã§ã™");}}
$("#btnCfg").addEventListener("click",openCfg);$("#cfgSave").addEventListener("click",saveCfg);$("#cfgCancel").addEventListener("click",()=>$("#cfgModal").classList.add("hidden"));
const CFG=getCfg();$("#cfgState").textContent=CFG?"è¨­å®šæ¸ˆ":"æœªè¨­å®š";if(!CFG)openCfg();
function b64(s){return btoa(unescape(encodeURIComponent(s)));}const attendeeURL=location.origin+location.pathname.replace(/[^\/]+$/,"")+"attendee.html?event="+encodeURIComponent(EVENT_ID)+(CFG?("&cfg="+b64(JSON.stringify(CFG))):"");$("#attendeeLink").href=attendeeURL;makeQR($("#qr"),attendeeURL);
const surveyURL=(new URL(location.href)).searchParams.get("survey")||"https://docs.google.com/forms/d/e/xxxxxxxx/formResponse";$("#surveyLink").href=surveyURL;makeQR($("#qrSurvey"),surveyURL);$("#btnSurvey").addEventListener("click",()=>{$("#survey").classList.remove("hidden");setTimeout(()=>{say("ã‚¢ãƒ ãƒ­","çš†ã•ã‚“ã€ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå…¥åŠ›ã¯ãŠæ¸ˆã¿ã§ã—ã‚‡ã†ã‹ï¼Ÿ");},100000);});
$("#btnEnding").addEventListener("click",()=>{document.getElementById("ending").classList.remove("hidden");say("ãƒ¡ãƒ¼ãƒ†ãƒ«","æœ€å¾Œã«ã“ã®å‹•ç”»ã‚’è¦–è´ã—ã¦ãã ã•ã„ã€‚");setTimeout(()=>{say("ãƒ¡ãƒ¼ãƒ†ãƒ«","ãã‚Œã§ã¯ã€éå»ã‹ã‚‰æœªæ¥ã¸å‘ã‘ã¦ã€ã—ã‚…ã£ã±ãƒ¼ã¤");},1200);setTimeout(()=>{say("å…¨å“¡","ã—ã‚…ã£ã±ãƒ¼ãƒ¼ã¤ï¼ï¼");player&&player.playVideo();},2400);});
function say(role,text){log(role+"ï¼š"+text);if("speechSynthesis"in window){const u=new SpeechSynthesisUtterance(text);u.lang="ja-JP";u.rate=role==="ãƒ©ãƒ ã¡ã‚ƒã‚“"?1.08:role==="ã‚¢ãƒ ãƒ­"?1.05:role==="æµå·"?0.95:1.0;u.pitch=role==="ãƒ©ãƒ ã¡ã‚ƒã‚“"?1.25:role==="ã‚¢ãƒ ãƒ­"?1.10:role==="æµå·"?0.95:1.05;speechSynthesis.speak(u);}}
const tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";document.body.appendChild(tag);let player=null;window.onYouTubeIframeAPIReady=function(){player=new YT.Player('player',{videoId:'5sjrQFWwTVE',playerVars:{rel:0,playsinline:1}});};
function makeQR(canvas,text){const ctx=canvas.getContext("2d");ctx.fillStyle="#fff";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#111";ctx.fillRect(10,10,200,200);ctx.fillStyle="#fff";ctx.font="12px monospace";ctx.fillText("QR",100,120);} // å®Ÿé‹ç”¨ã¯qrcodeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åŒæ¢±æ¨å¥¨
</script>
</body>
</html>
